<!-- 


    - session ë°©ì‹ ë¡œê·¸ì¸ ê¸°ëŠ¥ êµ¬í˜„í•˜ê¸°

    - ì¤€ë¹„
        1. ë¼ì´ë¸ŒëŸ¬ë¦¬ 3ê°œ ì„¤ì¹˜ (ë„ì–´ì“°ê¸°ë¡œ ì—¬ëŸ¬ê°œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ)
            í„°ë¯¸ë„> npm install passport passport-local express-session
        2. server.jsì— ë¼ì´ë¸ŒëŸ¬ë¦¬ ì²¨ë¶€
            // session - require
            const passport = require('passport');
            const LocalStrategy = require('passport-local').Strategy;
            const session = require('express-session');
            // session - ë¯¸ë“¤ì›¨ì–´
            app.use(session({secret : 'ë¹„ë°€ì½”ë“œ', resave : true, saveUninitialized: false}));
            app.use(passport.initialize());
            app.use(passport.session()); 

            â—ï¸ app.use(ë¯¸ë“¤ì›¨ì–´)
                => ì›¹ì„œë²„ëŠ” ìš”ì²­-ì‘ë‹µí•´ì£¼ëŠ” ê¸°ê³„
                => ìš”ì²­ê³¼ ì‘ë‹µ ì¤‘ê°„ì— ì‹¤í–‰ì‹œí‚¤ê³  ì‹¶ë‹¤ë©´ ë¯¸ë“¤ì›¨ì–´ ì‚¬ìš©

    1. ë¡œê·¸ì¸ í˜ì´ì§€ ì œì‘ & get
        - ejs íŒŒì¼ ë§Œë“¤ê³  getìœ¼ë¡œ ì ‘ì† ë¼ìš°íŒ…

    2. post ìš”ì²­ ì‘ë‹µ ë§Œë“¤ê¸° / ë¡œê·¸ì¸í•˜ë©´ ì•„ì´ë”” ë¹„ë²ˆ ê²€ì‚¬
        - passport ì‚¬ìš©
            => passportëŠ” ë¡œê·¸ì¸ ê¸°ëŠ¥ ì‰½ê²Œ êµ¬í˜„ ë„ì™€ì¤Œ
            => ê·¸ í•¨ìˆ˜ê°€ authenticate()
                app.post('/login', passport.authenticate('local', {
                                                        ğŸ”¸ ë¡œì»¬ ë°©ì‹ìœ¼ë¡œ ì¸ì¦í•´ ì£¼ì„¸ìš”~~
                    failureRedirect : '/fail'
                    ğŸ”¸ ì‹¤íŒ¨ì‹œ ì—¬ê¸°ë¡œ ì´ë™í•´ì£¼ì„¸ìš”~~
                }), (req, res)=>{
                    ë£°ë£¨ë„ë¼
                })

    3. ì•„ì´ë”” ë¹„ë²ˆ ì¸ì¦í•˜ëŠ” ì„¸ë¶€ ì½”ë“œ ì‘ì„±
        - ë¡œê·¸ì¸ ì‹œë„ ì‹œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œ
        - ì •í•´ì§„ ê³ ì • ì½”ë“œê°€ ê¸¸ì–´ì„œ ë³µë¶™ ê¶Œì¥
            passport.use(new LocalStrategy({

                    ğŸ”¸ 1) ìœ ì €ê°€ ì…ë ¥í•œ ì•„ì´ë”” / ë¹„ë²ˆ í•­ëª©ì´ ë­”ì§€ ì •ì˜( name ì†ì„± )
                    usernameField: 'id',    
                    passwordField: 'pw',

                    ğŸ”¸ 2) ì„¸ì…˜ ì •ë³´ ì €ì¥ ì—¬ë¶€
                    session: true,

                    passReqToCallback: false,   <=== ì•„ì´ë””/ë¹„ë²ˆ ë§ê³  ë‹¤ë¥¸ ì •ë³´ ê²€ì¦ì‹œ trueë¡œ ì‚¬ìš©

                    ğŸŸ¥  ì´ ì•„ë˜ í•¨ìˆ˜ ë¶€í„°ê°€ ê°€ì¥ ì¤‘ìš”í•œ ê²€ì¦ ë¶€ë¶„
                }, function (ì…ë ¥í•œì•„ì´ë””, ì…ë ¥í•œë¹„ë²ˆ, done) {
                    //console.log(ì…ë ¥í•œì•„ì´ë””, ì…ë ¥í•œë¹„ë²ˆ);

                    ğŸ”¸ 1) ë¨¼ì € ê³ ìœ ê°’ì¸ ì•„ì´ë”” ê²€ìƒ‰
                    db.collection('login').findOne({ id: ì…ë ¥í•œì•„ì´ë”” }, function (ì—ëŸ¬, ê²°ê³¼) {

                        /*
                        ğŸŸª return done()ì´ ë­ì•¼??
                            - 3ê°œì˜ íŒŒë¼ë¯¸í„°ë¥¼ ë°›ìŒ
                            - done( ì„œë²„ì—ëŸ¬(ë³´í†µ ë”°ë¡œ ì—ëŸ¬ì²˜ë¦¬í•¨), ì„±ê³µì‹œ ì‚¬ìš©ì DBë°ì´í„°, {message : 'ì—ëŸ¬ë©”ì‹œì§€ ë„£ëŠ”ê³³'} )
                            - ì„œë²„ì—ëŸ¬ëŠ” ë³´í†µ ë”°ë¡œ ì²˜ë¦¬í•´ì„œ nullë¡œ ë‘ 
                            - â—ï¸ ë‘ ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì¸ ì‚¬ìš©ì DBë°ì´í„°ë¥¼ falseë¡œ ì£¼ë©´
                                => app.post(passport.authenticate({
                                    failuRedirect : 'ê²½ë¡œ' <== ì—¬ê¸° ì‹¤í–‰ì‹œí‚´!!!
                                }), ì½œë°±í•¨ìˆ˜)
        
                            - ë‚˜ë¨¸ì§€ë„ ì‚¬ì‹¤ ì´ ì½”ë“œ ê·¸ëŒ€ë¡œ ë³µë¶™í•´ì„œ ì”€
                            - ëŒ€ì‹  ìœ ì˜ì  => ë³´ì•ˆì´ thë ˆê¸°
                                => ì…ë ¥í•œ ë¹„ë²ˆì„ ê·¸ëŒ€ë¡œ dbì˜ ë¹„ë²ˆì´ë‘ ëŒ€ì¡°í•¨
                                => ì•”í˜¸í™” í•„ìš”!!!(í•´ì‹œí•¨ìˆ˜ ë“± í™œìš©)
                        */

                        ğŸ”¸ 2) í”í•œ ì—ëŸ¬ì²˜ë¦¬
                        if (ì—ëŸ¬) return done(ì—ëŸ¬)

                        ğŸ”¸ 3) ê²°ê³¼ì— ì•„ë¬´ê²ƒë„ ë‹´ê¸°ì§€ ì•Šì•˜ì„ ë•Œ
                        if (!ê²°ê³¼) return done(null, false, { message: 'ì¡´ì¬í•˜ì§€ì•ŠëŠ” ì•„ì´ë””ìš”' })

                        ğŸ”¸ 4) id ì¼ì¹˜ ë°ì´í„° ì˜ ë‹´ê²¨ì™”ìœ¼ë©´ ë¹„ë²ˆ ê²€ì¦ 
                        if (ì…ë ¥í•œë¹„ë²ˆ == ê²°ê³¼.pw) {
                            return done(null, ğŸ¶ ê²°ê³¼)
                        } else {
                            return done(null, false, { message: 'ë¹„ë²ˆí‹€ë ¸ì–´ìš”' })
                        }
                    })
            }));
        - ì´ê²Œ local strategy <= ì¸ì¦í•˜ëŠ” ë°©ë²•ì„ strategyë¼ê³  ì¹­í•¨ 

    4. ì•„ì´ë”” / ë¹„ë²ˆ ë§ìœ¼ë©´ ì„¸ì…˜ í•˜ë‚˜ ë§Œë“¤ì–´ì¤˜ì•¼í•¨ (ë¡œê·¸ì¸ ì •ë³´ ë‹´ì•„ì¤˜ì•¼í•¨)
        - ê·¸ë˜ì•¼ ë§ˆì´í˜ì´ì§€ê°™ì€ê±° ê°€ë©´ ë³´ì—¬ì£¼ê±°ë‚˜ í•˜ì§€
            ğŸ”¸ 1) serializeUser() => ì„¸ì…˜ì„ ì €ì¥ì‹œí‚¤ëŠ” ì½”ë“œ(â—ï¸ ë¡œê·¸ì¸ ì„±ê³µì‹œ ë°œë™ â—ï¸)
                                              â¬‡ï¸ ğŸ”¹ ì•„ì´ë””/ë¹„ë²ˆ ê²€ì¦ ì„±ê³µì‹œ ì—¬ê¸°ë¡œ ğŸ¶ ê²°ê³¼ ê°€ ë“¤ì–´ì˜´
            passport.serializeUser(function (user, done) {
                              â¬‡ï¸ ğŸ”¹ user.idë¡œ ì„¸ì…˜ì„ ë§Œë“¦ (ë³´í†µ idë¥¼ ì´ìš©í•´ì„œ ì„¸ì…˜ì„ ì €ì¥)
                done(null, user.id) => ğŸ”¹ ì´í›„ ì¿ í‚¤ë¡œ ì„¸ì…˜ id ì •ë³´ë¥¼ ë³´ëƒ„
            });

            ğŸ”¸ 2) deserializeUser() => ì„¸ì…˜ ë°ì´í„°ê°€ ìˆìœ¼ë©´, ì–´ë–¤ ì‚¬ëŒì¸ì§€ í•´ì„í•˜ëŠ” ë¶€ë¶„
                    => ì´ ì„¸ì…˜ ë°ì´í„°ë¥¼ ê°€ì§„ ì‚¬ëŒì„ DBì—ì„œ ì°¾ì•„ì£¼ì„¸ìš” (ë§ˆì´í˜ì´ì§€ ë“± ì ‘ì†ì‹œ ë°œë™)
            passport.deserializeUser(function (ì•„ì´ë””, done) {
                done(null, {})
            }); 


    5. ì´ì œ ë¡œê·¸ì¸ì„ í•´ë³¼ê±´ë°
        - í¬ë¡¬ê¸°ì¤€ ê°œë°œìë„êµ¬ì°½ì—ì„œ Application => ì™¼ìª½ ì„¸ë¶€ë©”ë‰´ì—ì„œ Cookies>ë‚´ ì‚¬ì´íŠ¸ ëˆŒëŸ¬ë³´ë©´
        - ë¡œê·¸ì¸í•˜ë©´ ìƒˆë¡œìš´ ì •ë³´ê°€ ë“¤ì–´ì˜´
        - ê±°ê¸°ì„œ valueê°€ ë°”ë¡œ ì„¸ì…˜ ì•„ì´ë””!!



 -->